<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.105.0">
    <meta name="description" content="">


    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>交换路由 :: </title>

    
    <link href="/css/nucleus.css?1670906428" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1670906428" rel="stylesheet">
    <link href="/css/hybrid.css?1670906428" rel="stylesheet">
    <link href="/css/featherlight.min.css?1670906428" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1670906428" rel="stylesheet">
    <link href="/css/auto-complete.css?1670906428" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1670906428" rel="stylesheet">
    <link href="/css/theme.css?1670906428" rel="stylesheet">
    <link href="/css/tabs.css?1670906428" rel="stylesheet">
    <link href="/css/hugo-theme.css?1670906428" rel="stylesheet">
    
    <link href="/css/theme-blue.css?1670906428" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1670906428"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/basics/network/network/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1670906428"></script>
<script type="text/javascript" src="/js/auto-complete.js?1670906428"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/refinet.github.io";
    
</script>
<script type="text/javascript" src="/js/search.js?1670906428"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='/'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/basics/" title="Basics" class="dd-item
        parent
        
        
        ">
      <a href="/basics/">
          Basics
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/basics/network/" title="Network" class="dd-item
        parent
        
        
        ">
      <a href="/basics/network/">
          Network
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/basics/network/network/" title="交换路由" class="dd-item active">
        <a href="/basics/network/network/">
        交换路由
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/basics/terraform/" title="Terraform" class="dd-item
        
        
        
        ">
      <a href="/basics/terraform/">
          Terraform
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/basics/terraform/iac/" title="Terraform IaC" class="dd-item ">
        <a href="/basics/terraform/iac/">
        Terraform IaC
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/projects/" title="Projects" class="dd-item
        
        
        
        ">
      <a href="/projects/">
          Projects
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/projects/dso/" title="DSO-chapter" class="dd-item
        
        
        
        ">
      <a href="/projects/dso/">
          DSO-chapter
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/projects/dso/dso/" title="DSO Second_content" class="dd-item ">
        <a href="/projects/dso/dso/">
        DSO Second_content
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/projects/dso/dso_second_content/" title="DSO Second_content" class="dd-item ">
        <a href="/projects/dso/dso_second_content/">
        DSO Second_content
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="footer">
      

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>HomePage</a> > <a href='/basics/'>Basics</a> > <a href='/basics/network/'>Network</a> > 交换路由
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#table-of-contents">Table of Contents</a>
      <ul>
        <li><a href="#路由分类">路由分类</a></li>
        <li><a href="#动态配置命令">动态配置命令</a></li>
        <li><a href="#vlan间路由">vlan间路由</a></li>
        <li><a href="#交换机管理vlan">交换机管理vlan</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              交换路由
            </h1>
          

        


<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#%E8%B7%AF%E7%94%B1%E5%88%86%E7%B1%BB">路由分类</a></li>
<li><a href="#%E5%8A%A8%E6%80%81%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4">动态配置命令</a></li>
<li><a href="#vlan%E9%97%B4%E8%B7%AF%E7%94%B1">vlan间路由</a>
<ul>
<li><a href="#%E5%8D%95%E8%87%82%E8%B7%AF%E7%94%B1">单臂路由</a></li>
<li><a href="#%E4%B8%89%E5%B1%82%E4%BA%A4%E6%8D%A2%E6%9C%BA%E8%B7%AF%E7%94%B1%E4%BA%A4%E6%8D%A2">三层交换机路由交换</a></li>
</ul>
</li>
<li><a href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%AE%A1%E7%90%86vlan">交换机管理vlan</a></li>
</ul>
<h3 id="路由分类">路由分类</h3>
<pre tabindex="0"><code>- 静态路由
- 动态路由协议
    内部网关协议:
        距离矢量协议：RIPv2 EIGRP
        链路状态协议：OSPF ISIS
    外部网关协议：BGP
</code></pre><h3 id="动态配置命令">动态配置命令</h3>
<ul>
<li>RIP</li>
</ul>
<pre tabindex="0"><code>Router(config)#router rip       
#启动RIP路由选择进程
#RIP AD值120
Router(config-router)#network network-number    
#宣告网段，network-number是路由器接口直连的网段，如192.168.10.0
#RIP只支持主类网络宣告

Example:
 1.1.1.1/24    192.168.12.0/24    192.168.23.0/24    3.3.3.3/24
------------R1-----------------R2-----------------R3------------
R1:
router rip
network 1.0.0.0
network 192.168.12.0
R2:
router rip
network 192.168.12.0
network 192.168.23.0
R3:
router rip
network 192.168.23.0
network 3.0.0.0/24
</code></pre><ul>
<li>OSPF</li>
</ul>
<pre tabindex="0"><code>Router(config)#router ospf process-id
#开启OSPF进程
#OSPF AD值110
Router(config-router)#network address wildcard-mask area area-id
#宣告特定的网络到OSPF区域

Example1:
--------------------area 0------------------
|                                          |
|   192.168.12.0/24       192.168.23.0/24  |
R1--------------------R2-------------------R3
|                                          |
--------------------------------------------
R1:
router ospf 1
network 192.168.12.0 0.0.0.255 area 0
R2:
router ospf 1
network 192.168.12.0 0.0.0.255 area 0
network 192.168.23.0 0.0.0.255 area 0
R3:
router ospf 1
network 192.168.23.0 0.0.0.255 area 0

Example2:
---------area 0----------------area 1--------
|                     ｜                     |
|   192.168.12.0/24   ｜   192.168.23.0/24   |
R1--------------------R2--------------------R3
|                     ｜                     |
---------------------------------------------
R2:
router ospf 1
network 192.168.12.0 0.0.0.255 area 0
network 192.168.23.0 0.0.0.255 area 1
</code></pre><h3 id="vlan间路由">vlan间路由</h3>
<h4 id="单臂路由">单臂路由</h4>
<pre tabindex="0"><code>     R1-f1/0------------f0/0--WAN
     |f0/0
     |
     |
     |f0/15
     SW
  f0/1\ f0/2
   /   \ 
  /     \
 /f0/0   \f0/0
PC1     PC2

PC1:
no ip routing
ip default-gateway 192.168.10.254
int f 0/0
    ip add 192.168.10.1 255.255.255.0
    no shutdown
PC2:
no ip routing
ip default-gateway 192.168.20.254
int f 0/0
    ip add 192.168.20.1 255.255.255.0
    no shutdown

Switch:
vlan 10
vlan 20
#创建vlan 10 20
interface f 0/1
sw mo ac 
sw ac vlan 10
#把接口f 0/1划进vlan 10
interface f 0/2
sw mo ac
sw ac vlan 20
#把接口f 0/2划进vlan 20
interface f 0/15
switchport trunk encapsulation dot1q
switchport mode trunk
#把f 0/15配置为trunk

Router:
interface f 0/0
    no shutdown
#物理接口只需要no shutdown，不需要其他的配置
interface f 0/0.10
    encapsulation dot1Q 10
    ip add 192.168.10.254 255.255.255.0
    no shutdown
#创建子接口
interface f 0/0.20
    encapsulation dot1Q 20
    ip add 192.168.20.254 255.255.255.0
    no shutdown

interface f 1/0
    ip add 202.101.100.1 255.255.255.0
    no shutdown

conf t
access-list 1 permit 192.168.0.0 0.0.255.255
ip nat inside source list 1 interface f1/0 overload

interface f 1/0
ip nat outside
#定义nat outside接口
interface f0/0.10
ip nat inside
interface f0/0.20
ip nat inside
#注意，在子接口上定义nat inside

ip route 0.0.0.0 0.0.0.0 202.101.100.2
#出口设备，定义默认路由

WAN:
interface f 0/0
    ip add 202.101.100.2 255.255.255.0
    no shutdown

vlan间可以通信，也可以和WAN通信
</code></pre><h4 id="三层交换机路由交换">三层交换机路由交换</h4>
<pre><code>- 三层交换机的端口模式
    - 二层接口: access模式， trunk模式
    - 三层接口: 路由接口(no switchport), SVI接口
</code></pre>
<pre tabindex="0"><code>                |------------------------|
                |       L3-SWITCH        |
                |    interface vlan10    |
                |    interface vlan20    |   
                |    T           T   L3--|----------L3link-------Router
                |----|-----------|-------|
                     |trunk      |trunk
                     |           |
|--------------------|------| |--|-------------------------|
|        L2-SWITCH1  |      | |  |      L2-SWITCH2         |
|        10   10     T      | |  T      20   20            |
|         |                 | |              |             |
|---------|-----------------| |--------------|-------------|
          |                                  |
          PC1                                PC2



PC1:
no ip routing
ip default-gateway 192.168.10.254
int f 0/0
ip add 192.168.10.1 255.255.255.0

PC2:
no ip routing 
ip default-gateway 192.168.20.254
int f 0/0
ip add 192.168.20.1 255.255.255.0

L2-SWITCH1:
no ip routing
vlan 10
int f 0/0
switchport mode access
switchport access vlan 10

int f 0/24
switchport trunk encapsulation dot1Q
swithchport mode trunk

L2-SWITCH2:
no ip routing
vlan 20
int f0/0
switchport mode access
switchport access vlan 20

int f 0/24
switchport trunk encapsulation dot1Q
swithcport mode trunk

L3-SWITCH:
ip routing

vlan 10 
int vlan 10
ip add 192.168.10.254 255.255.255.0
no shutdown

vlan 20
int vlan 20
ip add 192.168.20.254 255.255.255.0
no shutdown

int f 0/0
switchport trunk encapsulation dot1Q
switchport mode trunk

int f 0/1
switchport trunk encapsulation dot1Q
switchport mode trunk

int f 0/2
no switchport
ip add 192.168.254.1 255.255.255.0
no shutdown

ip route 0.0.0.0 0.0.0.0 192.168.254.2

Router:
int f 0/0
ip add 192.168.254.2 255.255.255.0
no shutdown

ip route 192.168.0.0 255.255.0.0 192.168.254.1
</code></pre><h3 id="交换机管理vlan">交换机管理vlan</h3>
<ul>
<li>交换机的管理vlan用于交换机本身的设备管理</li>
<li>二层交换机只能有一个vlan接口可以拥有ip地址，具体的vlan可以更加实际需求设定</li>
<li>有了这个vlan接口，PC就能telnet到交换机上执行管理操作</li>
</ul>
<pre tabindex="0"><code>|--------------------------| |--------------------------|
| L2SWITCH                 | | L3SWITCH                 |
|                          | |                          |
| interface vlan255        | | interface vlan255        |
|                          | | interface vlan10         |
|                          | | interface vlan20         |
|                          | |                          |    
|   10     10        T-----|-|-----T   10    20         |    
|    |                     | |               |          |       
|----|---------------------| |---------------|----------|   
     |                                       |  
     |                                       |  
     PC1                                     PC2   

PC1:
no ip routing
ip default-gateway 192.168.10.254 255.255.255.0
int f 0/0
ip add 192.168.10.1

PC2:
no ip routing
ip default-gateway 192.168.20.254 255.255.255.0
int f 0/0
ip add 192.168.20.1

L2SWITCH:
no ip routing
vlan 10
vlan 255
int vlan 255
ip add 192.168.255.1 255.255.255.0
ip default-gateway 192.168.255.254 255.255.255.0
#因为二层交换机没有路由功能，所以需要给管理vlan设置默认网关，设置回程流量路由

int f 0/0
switchport mode access
switchport access vlan 10

int f 0/2
switchport trunk encapsulation dot1Q
switchport mode trunk

L3SWITCH:
vlan 10 
vlan 20
vlan 255

interface f 0/0
switchport mode access
switchport access vlan 20

interface f 0/2
switchport trunk encapsulation dot1Q
siwtchport mode trunk

interface vlan 10
ip add 192.168.10.254 255.255.255.0
interface vlan 20
ip add 192.168.20.254 255.255.255.0
interface vlan 255
ip add 192.168.255.254 255.255.255.0
</code></pre><p><a href="#table-of-contents">Back to top</a></p>
 

<footer class="footline">
	
</footer>

        
        </div>
        
      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/basics/network/" title="Network"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/basics/terraform/" title="Terraform" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1670906428"></script>
    <script src="/js/perfect-scrollbar.min.js?1670906428"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1670906428"></script>
    <script src="/js/jquery.sticky.js?1670906428"></script>
    <script src="/js/featherlight.min.js?1670906428"></script>
    <script src="/js/highlight.pack.js?1670906428"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1670906428"></script>
    <script src="/js/learn.js?1670906428"></script>
    <script src="/js/hugo-learn.js?1670906428"></script>
    
        
            <script src="/mermaid/mermaid.js?1670906428"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>

